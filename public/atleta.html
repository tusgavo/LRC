<!DOCTYPE html>
<html>
  <head>
    <!--Import Google Icon Font-->
    <link
      href="https://fonts.googleapis.com/icon?family=Material+Icons"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./css/atleta.css" />
    <link rel="shortcut icon" href="./assets/images/logo.ico" />

    <!--Import materialize.css-->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      src="https://kit.fontawesome.com/4e9705b432.js"
      crossorigin="anonymous"
    ></script>

    <title>Atletas</title>
  </head>

  <body>
    <header class="cabecalhoPrincipal">
      <div class="container">
        <h1 class="cabecalhoPrincipal-titulo">
          <a href="/"
            ><img src="./assets/images/logo.png" width="100px" alt=""
          /></a>
        </h1>

        <div class="cabecalhoPrincipal-nav">
          <a class="cabecalhoPrincipal-nav-link drop" href="/">Home</a>
          <a class="cabecalhoPrincipal-nav-link" href="/equipe">Equipe</a>
          <a class="cabecalhoPrincipal-nav-link" href="/atletas">Atletas</a>
        </div>
        <i
          class="fas fa-sign-out-alt fa-2x"
          id="iconExit"
          onclick="logout()"
          style="color: #fff; cursor: pointer"
        ></i>
      </div>
      <center>
        <div class="dropdown">
          <button
            class="btn btn-secondary dropdown-toggle dropdownColor"
            type="button"
            id="dropdownMenuButton"
            data-toggle="dropdown"
            aria-haspopup="true"
            aria-expanded="false"
          >
            Atletas
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="/">Home</a>
            <a class="dropdown-item" href="/equipe">Equipes</a>
            <a class="dropdown-item" href="/atletas">Atletas</a>
            <a class="dropdown-item" href="/login">Sair</a>
          </div>
        </div>
      </center>
    </header>

    <div class="container">
      <button class="btn btn-primary">
        <a href="#modal-criacao" class="modal-trigger botaoAddAtleta">
          Adicionar novo atleta
        </a>
      </button>

      <table class="table table-hover">
        <thead class="thead">
          <tr>
            <th class="idAtleta">ID Atleta</th>
            <th>Nome do Atleta</th>
            <th class="cpf">CPF</th>
            <th>Posição</th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody id="tabela"></tbody>
      </table>
    </div>

    <!-- Modal Structure -->
    <div id="modal-edicao" class="modal modalEdit">
      <div class="modal-content">
        <div class="row">
          <form id="form-edicao" class="col s12">
            <input type="hidden" id="ed-id_atleta" name="id_atleta" />
            <div class="row container teste">
              <div class="input-field col s12 inputEdit">
                <input
                  placeholder="Nome do atleta"
                  id="ed-nomeAtleta"
                  name="nomeAtleta"
                  type="text"
                  class="validate"
                />
                <label for="nomeAtleta">Nome do atleta</label>
              </div>
              <div class="input-field col s12 inputEdit">
                <input
                  placeholder="CPF"
                  id="ed-cpf"
                  name="cpf"
                  type="number"
                  class="validate"
                  max="11"
                />
                <label for="cpf">CPF</label>
              </div>
              <div class="input-field col s12 inputEdit">
                <input
                  placeholder="Posição"
                  id="ed-posicao"
                  name="posicao"
                  type="text"
                  class="validate"
                />
                <label for="posicao">Posição</label>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <a
          onclick="editarAtleta()"
          href="#!"
          style="color: white"
          class="modal-close waves-effect waves-blue btn-flat"
          >EDITAR</a
        >
      </div>
    </div>

    <!-- Modal Criação -->
    <div id="modal-criacao" class="modal container modalAdd">
      <div class="modal-content">
        <div class="row">
          <form id="form-criacao" class="col s12">
            <div class="row container teste">
              <div class="input-field col s12 inputAdd">
                <input
                  placeholder="Nome do atleta"
                  id="cr-nomeAtleta"
                  name="nomeAtleta"
                  type="text"
                  class="validate"
                />
                <label for="nomeAtleta">Nome do atleta</label>
              </div>
              <div class="input-field col s12 inputAdd">
                <input
                  placeholder="CPF"
                  id="cr-cpf"
                  name="cpf"
                  type="text"
                  class="validate"
                  maxlength="11"
                />
                <label for="cpf">CPF</label>
              </div>
              <div class="input-field col s12 inputAdd">
                <input
                  placeholder="Posição"
                  id="cr-posicao"
                  name="posicao"
                  type="text"
                  class="validate"
                />
                <label for="posicao">Posição</label>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <a
          onclick="criarAtleta()"
          href="#!"
          style="color: white"
          class="modal-close waves-effect waves-green btn-flat"
          >ADICIONAR ATLETA</a
        >
      </div>
    </div>

    <!-- Modal Structure -->
    <div id="modal-delecao" class="modal modalDeletar">
      <div class="modal-content">
        <h5>Confirmar Deleção do Atleta</h5>
      </div>
      <form id="form-delecao">
        <input type="hidden" name="id_atleta" id="dl-id_atleta" />
      </form>
      <div class="modal-footer">
        <center>
          <a
            onclick="deletarAtleta()"
            href="#!"
            style="color: white"
            class="modal-close waves-effect waves-red btn-flat red"
            >CONFIRMAR DELEÇÃO</a
          >
        </center>
      </div>
    </div>

    <!--JavaScript at end of body for optimized loading-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
    <script>
      let modalCriacao = null;
      let modalEdicao = null;
      document.addEventListener("DOMContentLoaded", function () {
        var elems = document.querySelectorAll(".modal");
        var instances = M.Modal.init(elems, {});
        modalEdicao = instances[0];
        modalCriacao = instances[1];
        modalDelecao = instances[2];
      });
    </script>
    <script>
      let listaDeAtletas = [];
      let tabela = document.getElementById("tabela");

      function mostraModal(i) {
        modalEdicao.open();
        document.getElementById("ed-id_atleta").value =
          listaDeAtletas[i].id_atleta;
        document.getElementById("ed-nomeAtleta").value =
          listaDeAtletas[i].nomeAtleta;
        document.getElementById("ed-cpf").value = listaDeAtletas[i].cpf;
        document.getElementById("ed-posicao").value = listaDeAtletas[i].posicao;
      }

      function mostraModalDelecao(i) {
        modalDelecao.open();
        document.getElementById("dl-id_atleta").value =
          listaDeAtletas[i].id_atleta;
      }
      function atualiza() {
        fetch("/rotasTeste")
          .then((res) => res.json())
          .then((dados) => {
            listaDeAtletas = dados;
            tabela.innerHTML = listaDeAtletas
              .map(
                (atleta, i) => `
                  <tr>
                      <td class="idAtleta">${atleta.id_atleta}</td>
                      <td>${atleta.nomeAtleta}</td>
                      <td class="cpf">${atleta.cpf}</td>
                      <td>${atleta.posicao}</td>
                      <td><i class="fas edit fa-edit" onclick="mostraModal(${i})"></i></td>
                      <td><i class="fas icon fa-times delete fa-lg" onclick="mostraModalDelecao(${i})"></i></td>
                  </tr>
              `
              )
              .join("");
          });
      }
      atualiza();

      function criarAtleta() {
        const formulario = document.getElementById("form-criacao");
        const data = new URLSearchParams(new FormData(formulario));
        fetch("/rotasTeste", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: data,
        });
        Swal.fire("Sucesso!", "Seu atleta foi adicionado!", "success");
        setTimeout(function () {
          window.location.reload();
        }, 1500);
      }

      function editarAtleta() {
        const formulario = document.getElementById("form-edicao");
        const data = new URLSearchParams(new FormData(formulario));
        fetch("/rotasTeste", {
          method: "PUT",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: data,
        });
        Swal.fire("Sucesso!", "Seu atleta foi editado!", "success");
        setTimeout(function () {
          window.location.reload();
        }, 1200);
      }

      function deletarAtleta() {
        const id = document.getElementById("dl-id_atleta").value;
        fetch("/rotasTeste/" + id, {
          method: "DELETE",
        });
        Swal.fire("Sucesso!", "Seu atleta foi excluído!", "success");
        setTimeout(function () {
          window.location.reload();
        }, 1600);
      }
    </script>
  </body>
  <script
    src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
    integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
    integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
    integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
    crossorigin="anonymous"
  ></script>
</html>
